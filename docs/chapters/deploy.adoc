== Deploying Applications to WildFly

*Purpose*: This section explains different ways to deploy Java EE 7 applications to WildFly.

Make sure to start a WildFly standalone instance for each sub-section unless stated otherwise. A standalone instance can be started as:

[source]
----
./bin/standalone.sh
----

=== File system

*Purpose*: This section explains how to deploy a Java EE 7 application to WildFly using filesystem commands.

Any archive (e.g. war, ear, jar, and sar files) can be placed in the `standalone/deployments` directory in order to be automatically deployed to the server.

CAUTION: This deployment mode is only intended to be used during development phase. Other modes are recommended if running production systems.

Copy the war file to `standalone/deployments` directory using the following command:

[source]
----
cp target/javaee7-1.0-SNAPSHOT.war /Users/arungupta/workspaces/wildfly/build/target/wildfly-8.0.0.Final-SNAPSHOT/standalone/deployments
----

Verify the deployed application by accessing the webpage http://localhost:8080/javaee7-1.0-SNAPSHOT/EmployeeList and see the output as:

image:images/deploy-javaee7-sample-output.png[Java EE 7 Sample Application Output]

=== Command Line Interface

*Purpose*: This section discusses different ways to deploy an application to WildFly using Command Line Interface.

==== jboss-cli

`bin/jboss-cli.sh` or `bin/jboss-cli.bat` is Command Line Interface management tool for a standalone server or a managed domain. It allows a user to connect to a standalone server or domain controller and execute management operations.

More details about using jboss-cli for managing the server are available in <<jboss-cli>>.

*Purpose*: This section explains how to deploy a Java EE 7 application to WildFly using `jboss-cli'.

`jboss-cli' can be used to deploy applications using the interactive console or in a non-interactive manner.

===== Interactive

. Use jboss-cli to connect with the existing standalone instance by giving the following command:
+
[source]
----
jboss-cli.sh -c
----
+
The `-c` switch connects using the default host (`localhost') and management port (`9990'). These values are specified in `bin/jboss-cli.xml' and can be updated.
+
This opens up the `jboss-cli' interactive console and shows the following prompt:
+
[source]
----
[standalone@localhost:9990 /]
----
+
The prompt indicates that `jboss-cli' is connected to a standalone instance's management port.
+
. Deploy the application by giving the following command in console:
+
[source]
----
deploy target/javaee7-1.0-SNAPSHOT.war
----
+
The directory name of the war file in the command may be different depending upon how `jboss-cli' was invoked. Verify the server log to ensure that the application was redeployed. Look for specific timestamp in the log entries.
+
TIP: `--force` switch can be included in the command to redeploy the application.
+
. Verify the deployment status by typing the following command `deployment-info` in the console:
+
[source]
----
deployment-info
----
+
and see the output as:
+
[source]
----
NAME                     RUNTIME-NAME             PERSISTENT ENABLED STATUS 
javaee7-1.0-SNAPSHOT.war javaee7-1.0-SNAPSHOT.war true       true    OK   
----
+
Verify the server log to ensure that the application was deployed. Look for specific timestamp in the log entries.
+
. Undeploy the application by giving the following command:
+
[source]
----
undeploy javaee7-1.0-SNAPSHOT.war
----
+
. Type `exit` `quit' to exit `jboss-cli' interactive console.

===== Non-interactive

Non-interactive mode allows to support scripts and other types of command line or batch processing.

. Deploy the application using the following command:
+
[source]
----
jboss-cli.sh --connect --command="deploy target/javaee7-1.0-SNAPSHOT.war --force"
----
+
The directory name of the war file in the command may be different depending upon how `jboss-cli' was invoked. Verify the server log to ensure that the application was redeployed. Look for specific timestamp in the log entries.
+
Verify the deployed application at http://localhost:8080/javaee7/EmployeeList and look for a similar output.
+
. Verify the deployment status by giving the following command:
+
[source]
----
./bin/jboss-cli.sh --connect --command=deployment-info
----
+
. Undeploy the application by giving the following command:
+
[source]
----
./bin/jboss-cli.sh --connect --command="undeploy javaee7-1.0-SNAPSHOT.war"
----

==== Curl

curl is a free and popular command line tool for transfering data using URL syntax. If you don't have it installed on your machine then it can be downloaded from http://curl.haxx.se/download.html.

*Purpose*: This section explains how to deploy a Java EE 7 application to WildFly using curl.

==== HTTP APIs

http://localhost:9990/management?operation=deploy

*Purpose*: This section explains how to deploy a Java EE 7 application to WildFly using HTTP API.

=== Admin Console

The Admin Console is a web-based administration console and available at http://localhost:9990/console.

*Purpose*: This section explains how to deploy a Java EE 7 application to WildFly using web-based Administration Console.

. A new user in the management realm needs to be added before the admin console can be accessed.
+
A new user can be added in the management realm using `bin/add-user.sh` script. This can be done non-interactively by giving the following command:
+
[source]
----
./bin/add-user.sh -u sheldon -p baz^ngaA
----
+
The output of the command looks like:
+
[source]
----
Added user 'sheldon' to file '/Users/arungupta/workspaces/wildfly/build/target/wildfly-8.0.0.Final-SNAPSHOT/standalone/configuration/mgmt-users.properties'
Added user 'sheldon' to file '/Users/arungupta/workspaces/wildfly/build/target/wildfly-8.0.0.Final-SNAPSHOT/domain/configuration/mgmt-users.properties'
----
+
The directory names `standalone' and `domain' indicate that the user is added to both standalone instance and managed domain. The file name indicates that it is added to the management realm.
+
TIP: A user can be added to application realm by including `-a` switch.
+
Alternatively, the user can be added interactively by invoking the script and entering the values on the prompt as shown:
+
[source]
----
./bin/add-user.sh

What type of user do you wish to add? 
 a) Management User (mgmt-users.properties) 
 b) Application User (application-users.properties)
(a):

Enter the details of the new user to add.
Using realm 'ManagementRealm' as discovered from the existing property files.
Username : sheldon
Password requirements are listed below. To modify these restrictions edit the add-user.properties configuration file.
 - The password must not be one of the following restricted values {root, admin, administrator}
 - The password must contain at least 8 characters, 1 alphanumeric character(s), 1 digit(s), 1 non-alphanumeric symbol(s)
 - The password must be different from the username
Password : baz1ngaa!
Re-enter Password : baz1ngaa!
What groups do you want this user to belong to? (Please enter a comma separated list, or leave blank for none)[  ]: 
About to add user 'sheldon' for realm 'ManagementRealm'
Is this correct yes/no? *yes*
Added user 'sheldon' to file '/Users/arungupta/workspaces/wildfly/build/target/wildfly-8.0.0.Final-SNAPSHOT/standalone/configuration/mgmt-users.properties'
Added user 'sheldon' to file '/Users/arungupta/workspaces/wildfly/build/target/wildfly-8.0.0.Final-SNAPSHOT/domain/configuration/mgmt-users.properties'
Added user 'sheldon' with groups  to file '/Users/arungupta/workspaces/wildfly/build/target/wildfly-8.0.0.Final-SNAPSHOT/standalone/configuration/mgmt-groups.properties'
Added user 'sheldon' with groups  to file '/Users/arungupta/workspaces/wildfly/build/target/wildfly-8.0.0.Final-SNAPSHOT/domain/configuration/mgmt-groups.properties'
Is this new user going to be used for one AS process to connect to another AS process? 
e.g. for a slave host controller connecting to the master or for a Remoting connection for server to server EJB calls.
yes/no? no
----
+
Now accessing the console at http://localhost:9990/console prompts for a username and password. Enter the username `sheldon' and password `baz^ngaA' and then the console is shown as:
+
image:images/deploy-admin-console.png[Admin Console]
+
. Click on `Manage Deployments' to see the output as:
+
image:images/deploy-admin-console-deployments-first.png[Admin Console Deployments]
+
. Click on `Add' button to see:
+
image:images/deploy-admin-console-add-first.png[Add a Deployment]
+
. Click on `Choose File' button and select the war file.
+
Click on `Next' button.
+
. What names to choose here ?
+
Deploying through admin console is giving 404 at http://localhost:8080/javaee7-1.0-SNAPSHOT.war/EmployeeList

=== Maven plugin

The wildfly-maven-plugin is used to deploy, redeploy, undeploy or run your application. You can also deploy or undeploy artifacts, such as JDBC drivers, and add or remove resources. There is also the ability to execute CLI commands.

*Purpose*: This section explains how to deploy Java EE 7 applications to WildFly use the maven plugin.

. Add the following fragment to samples/javaee7/pom.xml:
+
[source, xml]
----
<plugin>
    <groupId>org.wildfly.plugins</groupId>
    <artifactId>wildfly-maven-plugin</artifactId>
    <version>1.0.0.Beta1</version>
    <executions>
        <execution>
            <phase>install</phase>
            <goals>
                <goal>deploy</goal>
            </goals>
        </execution>
    </executions>
</plugin>
----
along with other <plugin> elements.
+
This adds the `wildfly-maven-plugin' description to `pom.xml'. It also invokes the plugin `deploy' target during the standard maven `install' phase.
+
. Start a WildFly instance as:
+
[source]
----
./bin/standalone.sh
----
+
. Deploy the application by giving the command:
+
[source]
----
mvn wildfly:deploy
----
+
or
+
[source]
----
mvn install
----
+
. Access the web page at http://localhost:8080/javaee7/TestServlet and see the output as:
+
image:images/deploy-javaee7-sample-output.png[Java EE 7 Sample Application Output]

